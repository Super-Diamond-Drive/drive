<html>
<head>
</head>
<body>
<div id="home">
<center><h1>Welcome to The Super Diamond Drive Manager</h1></center>
<p><a onclick="Open('https://github.com/Super-Diamond-Drive/templates/tree/main')">Templates</a> <a onclick="Open('https://github.com/Super-Diamond-Drive/drive/tree/main/runners')">Runners</a></p>
<button onclick="openFile(prompt('Enter File Name of file you would like to view or edit'))">Open File</button>
<button onclick="runFile(prompt('Enter File Name of file you would like to run'), prompt('As what file type would you like to run the file'))">Run File</button>
<button onclick="deleteFile(prompt('Enter File Name of file you would like to delete'))">Delete File</button>
<button onclick="fileUpload()">Upload file</button>
<button onclick="downloadFile(prompt('Enter File Name'))">Download</button>
<button onclick="openSoftware(prompt('Enter Software Name'))">Software (WARNING: Will Break App If Software does not exsist)</button>
<iframe id="file_list" width="100%" height="100%" src="core_files/file-list.html"></iframe>
</div>
<script>
function openSoftware(name) {
 location.replace("software/" + name + ".html")
}

function downloadFile(name) {
 var content = localStorage.getItem(name)
 download(name, content)
}
function download(filename, text) {
    var pom = document.createElement('a');
    pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    pom.setAttribute('download', filename);

    if (document.createEvent) {
        var event = document.createEvent('MouseEvents');
        event.initEvent('click', true, true);
        pom.dispatchEvent(event);
    }
    else {
        pom.click();
    }
}

 function Open(url) {
  return open(url);
 }
 function openFile(fileName) {
  document.getElementById("fileOpened").style.display = "block"
  document.getElementById("home").style.display = "none"
  document.getElementById("fileDataInput").value = localStorage.getItem(fileName)
 }
 function saveFile(fileName) {
  localStorage.setItem(fileName, document.getElementById("fileDataInput").value)
  document.getElementById("fileOpened").style.display = "none"
  document.getElementById("home").style.display = "block"
  document.getElementById("file_list").src = "core_files/file-list.html"
 }
 function deleteFile(fileName) {
  if(confirm("are you sure you want to delete " + fileName + "?")) {
   localStorage.removeItem(fileName)
  }
 }
 function runFile(fileName, runnerType) {
  var runframe = document.createElement("iframe")
  runframe.src = "runners/" + runnerType + ".html"
  runframe.style.display = "none"
  document.body.appendChild(runframe)
  runframe.contentWindow.postMessage(localStorage.getItem(fileName), "*")
 }

 function fileUpload() {
  document.getElementById("fileUpload").style.display = "block"
  document.getElementById("home").style.display = "none"
 }
function addFileFromUpload() {
var file = document.getElementById("fileForUpload").files[0];
var fileContent = "reading..."
var fileName = file.name;
if (file) {
    var reader = new FileReader();
    reader.readAsText(file, "UTF-8");
    reader.onload = function (evt) {
     fileContent = evt.target.result;
     localStorage.setItem(fileName, fileContent)
     document.getElementById("fileUpload").style.display = "none"
     document.getElementById("home").style.display = "block"
     document.getElementById("file_list").src = "core_files/file-list.html"
    }
    reader.onerror = function (evt) {
     alert("we encoutered an error while reading file content. please try again")
    }
}
}
</script>
<div id="fileOpened" style="display: none">
<button onclick="saveFile(prompt('Enter File Name. you may be copying it or editing and making a new file. enter a exsisting file name to overwrite it'))">Save As</button>
<textarea id="fileDataInput" rows="300" cols="400"></textarea>
</div>
<div id="fileUpload" style="display: none">
<p><input id="fileForUpload" type="file"></input></p>
<p><button onclick="addFileFromUpload()">Upload File</button></p>
</div>
</body>
</html>
